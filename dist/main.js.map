{"version":3,"file":"main.js","sourceRoot":"","sources":["../src/main.ts"],"names":[],"mappings":"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","sourcesContent":["const canvas = document.getElementById(\"canvas\") as HTMLCanvasElement;\nconst ctx = canvas.getContext(\"2d\");\n\nconst shotSound = new Audio(\"lmg_fire01.flac\");\n\ntype Disc = {\n  x: number;\n  y: number;\n  radius: number;\n  velocity: number;\n  remove: boolean;\n};\n\nconst gameState = {\n  ctx: ctx!,\n  mousePosition: { x: 0, y: 0 },\n  discs: [] as Array<Disc>,\n  paused: true,\n  bullets: 10,\n};\n\ntype GameState = typeof gameState;\n\nenum ShotAccuracy {\n  Missed,\n  Touch,\n  Perfect,\n}\n\nfunction shot(\n  a: Pick<Disc, \"x\" | \"y\" | \"radius\">,\n  b: Disc,\n  tolerance: number = 1\n): ShotAccuracy {\n  const dx = b.x - a.x;\n  const dy = b.y - a.y;\n  const distanceSquared = dx * dx + dy * dy;\n  const radiusSum = a.radius + b.radius + tolerance;\n  const radiusSumSquared = radiusSum * radiusSum;\n  const radiusDiff = Math.abs(a.radius - b.radius) - tolerance;\n  const radiusDiffSquared = radiusDiff * radiusDiff;\n\n  if (distanceSquared > radiusSumSquared) {\n    return ShotAccuracy.Missed;\n  }\n\n  if (\n    distanceSquared >= radiusDiffSquared &&\n    distanceSquared <= radiusSumSquared\n  ) {\n    return ShotAccuracy.Perfect;\n  }\n\n  return ShotAccuracy.Touch;\n}\n\nfunction resizeCanvas(ctx: CanvasRenderingContext2D) {\n  const aspect = 16 / 9;\n\n  let width = window.innerWidth;\n  let height = window.innerHeight;\n\n  // Adjust height to keep ratio\n  if (width / height > aspect) {\n    width = height * aspect;\n  } else {\n    height = width / aspect;\n  }\n\n  canvas.style.width = width + \"px\";\n  canvas.style.height = height + \"px\";\n\n  // Set actual drawing buffer (high DPI support)\n  const dpr = window.devicePixelRatio || 1;\n  canvas.width = width * dpr;\n  canvas.height = height * dpr;\n\n  ctx.setTransform(1, 0, 0, 1, 0, 0); // reset any scaling\n  ctx.scale(dpr, dpr); // ensure drawings are sharp\n}\n\nfunction renderCircle(\n  ctx: CanvasRenderingContext2D,\n  position: { x: number; y: number },\n  radius: number,\n  color: string\n) {\n  ctx.fillStyle = color;\n  ctx.beginPath();\n  ctx.arc(position.x, position.y, radius, 0, 2 * Math.PI, true);\n  ctx.fill();\n}\n\nfunction renderCursor(ctx: CanvasRenderingContext2D) {\n  renderCircle(ctx, gameState.mousePosition, 3, \"#181818\");\n}\n\nfunction renderDiscs(state: GameState, delta: number) {\n  for (const disc of state.discs) {\n    renderCircle(state.ctx, { x: disc.x, y: disc.y }, disc.radius, \"red\");\n    disc.x += delta * disc.velocity;\n    if (disc.x > canvas.width) {\n      // @todo: you missed this one handle it properly\n      disc.remove = true;\n    }\n  }\n}\n\nfunction renderStats(ctx: CanvasRenderingContext2D) {\n  ctx.fillStyle = \"black\";\n  ctx.font = \"18px sans-serif\";\n  ctx.fillText(`Bullets: ${gameState.bullets}`, 20, 30);\n}\n\nfunction render(ctx: CanvasRenderingContext2D, delta: number) {\n  ctx.fillStyle = \"#fafafa\";\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  renderStats(ctx);\n  renderDiscs(gameState, delta);\n  renderCursor(ctx);\n}\n\n// Call once and on resize\nwindow.addEventListener(\"resize\", () => {\n  resizeCanvas(ctx!);\n});\n\nresizeCanvas(ctx!);\n\nfunction handleMouseMovement(event: MouseEvent) {\n  gameState.mousePosition.x += event.movementX;\n  gameState.mousePosition.y += event.movementY;\n}\n\nfunction handleMouseClick(_event: MouseEvent) {\n  let accuracy = ShotAccuracy.Missed;\n\n  shotSound.currentTime = 0;\n  shotSound.play();\n\n  for (const disc of gameState.discs) {\n    accuracy = shot(\n      {\n        x: gameState.mousePosition.x,\n        y: gameState.mousePosition.y,\n        radius: 2,\n      },\n      disc\n    );\n\n    if (accuracy === ShotAccuracy.Touch || accuracy === ShotAccuracy.Perfect) {\n      disc.remove = true;\n      break;\n    }\n  }\n\n  switch (accuracy) {\n    case ShotAccuracy.Missed:\n      {\n        gameState.bullets -= 1;\n      }\n      break;\n\n    case ShotAccuracy.Touch:\n      {\n      }\n      break;\n\n    case ShotAccuracy.Perfect:\n      {\n        gameState.bullets += 1;\n      }\n      break;\n  }\n}\n\nfunction handleKeyDown(event: KeyboardEvent) {\n  if (event.code === \"Space\") {\n    const rand = Math.random();\n    gameState.discs.push({\n      x: 0,\n      y: canvas.height * rand,\n      radius: 10,\n      velocity: 200 * rand,\n      remove: false,\n    });\n  }\n}\n\ncanvas.addEventListener(\"click\", async () => {\n  if (!document.pointerLockElement) {\n    await canvas.requestPointerLock({\n      unadjustedMovement: true,\n    });\n  }\n});\n\ndocument.addEventListener(\"pointerlockchange\", () => {\n  if (document.pointerLockElement === canvas) {\n    document.addEventListener(\"mousemove\", handleMouseMovement);\n    document.addEventListener(\"mousedown\", handleMouseClick);\n    document.addEventListener(\"keydown\", handleKeyDown);\n\n    gameState.paused = false;\n  } else {\n    document.removeEventListener(\"mousemove\", handleMouseMovement);\n    document.removeEventListener(\"mousedown\", handleMouseClick);\n    document.removeEventListener(\"keydown\", handleKeyDown);\n\n    gameState.paused = true;\n  }\n});\n\nlet previousTimestamp: DOMHighResTimeStamp = 0;\n\nfunction gameLoop(timestamp: DOMHighResTimeStamp) {\n  const delta = (timestamp - previousTimestamp) / 1000;\n  previousTimestamp = timestamp;\n\n  if (!gameState.paused) {\n    gameState.discs = gameState.discs.filter((x) => !x.remove);\n\n    render(ctx!, delta);\n  }\n\n  requestAnimationFrame(gameLoop);\n}\n\n// skip the first frame so we can save the previousTimestamp correctly\nrequestAnimationFrame((timestamp) => {\n  previousTimestamp = timestamp;\n  requestAnimationFrame(gameLoop);\n});\n"]}