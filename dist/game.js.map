{"version":3,"file":"game.js","sourceRoot":"","sources":["../src/game.ts"],"names":[],"mappings":"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","sourcesContent":["import { clamp, renderCircle, renderText, type TText } from \"./utils.js\";\n\nconst shotSound = new Audio(\"lmg_fire01.flac\");\nconst loseSound = new Audio(\"lose sound 2 - 2.flac\");\n\nexport const gameState = {\n  width: 0, // will be initialized on main.ts\n  height: 0, // will be initialized on main.ts\n  mousePosition: { x: 0, y: 0 },\n  targets: [] as Array<TTarget>,\n  paused: true,\n  gameOver: false,\n  availableShots: 2,\n  shots: {\n    missed: 0,\n    good: 0,\n    perfect: 0,\n  },\n  lastSpawedDisc: 0,\n  accuracy: 0,\n  texts: [] as Array<{ text: TText; duration: number; remove: boolean }>,\n  maxDiscRadius: 100,\n};\n\nexport type GameState = typeof gameState;\n\ntype Aim = {\n  x: number;\n  y: number;\n  radius: number;\n};\n\nenum ShotAccuracy {\n  Missed,\n  Touch,\n  Perfect,\n}\n\nexport function shot(a: Aim, b: TTarget, tolerance: number = 1): ShotAccuracy {\n  const dx = b.x - a.x;\n  const dy = b.y - a.y;\n  const distanceSquared = dx * dx + dy * dy;\n  const radiusSum = a.radius + b.radius + tolerance;\n  const radiusSumSquared = radiusSum * radiusSum;\n  const radiusDiff = Math.abs(a.radius - b.radius) - tolerance;\n  const radiusDiffSquared = radiusDiff * radiusDiff;\n\n  if (distanceSquared > radiusSumSquared) {\n    return ShotAccuracy.Missed;\n  }\n\n  if (\n    distanceSquared >= radiusDiffSquared &&\n    distanceSquared <= radiusSumSquared\n  ) {\n    return ShotAccuracy.Touch;\n  }\n\n  return ShotAccuracy.Perfect;\n}\n\nexport function renderAim(ctx: CanvasRenderingContext2D) {\n  renderCircle(ctx, gameState.mousePosition, 3, \"#181818\");\n}\n\nexport function renderStats(ctx: CanvasRenderingContext2D) {\n  renderText(ctx, {\n    text: `Available Shots: ${gameState.availableShots}`,\n    x: 20,\n    y: 30,\n    font: \"18px sans-serif\",\n    color: \"black\",\n  });\n\n  const { good, missed, perfect } = gameState.shots;\n  const accuracy = (good + perfect) / (missed + good + perfect);\n\n  renderText(ctx, {\n    text: `Total Shots: ${good + perfect + missed}`,\n    x: 20,\n    y: 60,\n    font: \"18px sans-serif\",\n    color: \"black\",\n  });\n\n  renderText(ctx, {\n    text: `Accuracy: ${Math.floor(accuracy * 100)}%`,\n    x: 20,\n    y: gameState.height - 20,\n    font: \"18px sans-serif\",\n    color: \"black\",\n  });\n}\n\nexport function handleMouseClick(_event: MouseEvent) {\n  let accuracy = ShotAccuracy.Missed;\n\n  shotSound.currentTime = 0;\n  shotSound.play();\n\n  const aim = {\n    x: gameState.mousePosition.x,\n    y: gameState.mousePosition.y,\n    radius: 2,\n  };\n\n  for (const disc of gameState.targets) {\n    accuracy = shot(aim, disc);\n    if (accuracy === ShotAccuracy.Touch || accuracy === ShotAccuracy.Perfect) {\n      disc.remove = true;\n      break;\n    }\n  }\n\n  switch (accuracy) {\n    case ShotAccuracy.Missed:\n      {\n        gameState.availableShots -= 1;\n        gameState.shots.missed += 1;\n\n        gameState.texts.push({\n          text: {\n            text: \"You missed!\",\n            x: aim.x - 20,\n            y: aim.y + 20,\n            font: \"14px sans-serif\",\n            color: \"black\",\n          },\n          duration: 0.5,\n          remove: false,\n        });\n      }\n      break;\n\n    case ShotAccuracy.Touch:\n      {\n        gameState.shots.good += 1;\n        gameState.texts.push({\n          text: {\n            text: \"Good shot!\",\n            x: aim.x - 20,\n            y: aim.y + 20,\n            font: \"14px sans-serif\",\n            color: \"black\",\n          },\n          duration: 0.5,\n          remove: false,\n        });\n      }\n      break;\n\n    case ShotAccuracy.Perfect:\n      {\n        gameState.shots.perfect += 1;\n        gameState.availableShots += 1;\n\n        gameState.texts.push({\n          text: {\n            text: \"Perfect shot!\",\n            x: aim.x - 20,\n            y: aim.y + 20,\n            font: \"14px sans-serif\",\n            color: \"black\",\n          },\n          duration: 0.5,\n          remove: false,\n        });\n      }\n      break;\n  }\n}\n\nexport type TTarget = {\n  x: number;\n  y: number;\n  radius: number;\n  velocity: number;\n  remove: boolean;\n  duration: number; // stay alive in seconds\n  maxDuration: number;\n};\n\nexport function spawTarget() {\n  const rand = Math.random();\n\n  const padding = 100;\n  const radius = clamp(\n    gameState.maxDiscRadius * rand,\n    gameState.maxDiscRadius / 5,\n    gameState.maxDiscRadius\n  );\n  const x = clamp(\n    gameState.width * rand,\n    radius + padding,\n    gameState.width - radius - padding\n  );\n  const y = clamp(\n    gameState.height * rand,\n    radius + padding,\n    gameState.height - radius - padding\n  );\n\n  gameState.targets.push({\n    x,\n    y,\n    radius,\n    velocity: 200 * rand,\n    remove: false,\n    duration: 2,\n    maxDuration: 2,\n  });\n}\n\nexport function renderTargets(\n  ctx: CanvasRenderingContext2D,\n  targets: Array<TTarget>,\n  delta: number\n) {\n  for (const target of targets) {\n    ctx.strokeStyle = \"#AD391F\";\n\n    const lineWidth = target.radius / 10;\n    ctx.lineWidth = lineWidth;\n    ctx.beginPath();\n    const progress = target.duration / target.maxDuration;\n    ctx.arc(\n      target.x,\n      target.y,\n      target.radius + 1,\n      0,\n      2 * Math.PI * progress,\n      true\n    );\n    ctx.stroke();\n\n    renderCircle(ctx, { x: target.x, y: target.y }, target.radius, \"#F54927\");\n\n    target.duration -= delta;\n    if (target.duration < 0) {\n      gameState.availableShots -= 1;\n\n      gameState.texts.push({\n        text: {\n          text: \"You missed!\",\n          x: target.x - 20,\n          y: target.y + 20,\n          font: \"14px sans-serif\",\n          color: \"red\",\n        },\n        duration: 0.5,\n        remove: false,\n      });\n      target.remove = true;\n\n      loseSound.currentTime = 0;\n      loseSound.play();\n    }\n  }\n}\n\nexport function render(ctx: CanvasRenderingContext2D, delta: number) {\n  ctx.fillStyle = \"#fafafa\";\n  ctx.fillRect(0, 0, gameState.width, gameState.height);\n\n  renderStats(ctx);\n  renderTargets(ctx, gameState.targets, delta);\n\n  for (const text of gameState.texts) {\n    if (text.duration <= 0) {\n      text.remove = true;\n      continue;\n    }\n\n    renderText(ctx, text.text);\n    text.duration -= delta;\n  }\n\n  renderAim(ctx);\n}\n"]}